(ns tests.logic.offense-tests
  (:use clojure.test
        borg.logic.geometry
        borg.logic.offense
        clojure.contrib.math))

(defn- difference-between-modified-slope-and-actual [factor p1 p2 p3 p4]
  (- (invert (modify-slope factor (slope p1 p2))) (slope p3 p4)))

(deftest modify-slope-tests
  (are [f p1 p2 p3 p4] (< (abs (difference-between-modified-slope-and-actual f p1 p2 p3 p4)) 0.05)
    3/7 {:x 64.20929945492941, :y 43.35769959306079} {:x 43.07171140124179, :y 59.82921673600332} {:x 27.092522457818404, :y 86.29754935220093} {:x 45.75537242906242, :y 95.11532888241534}
    3/7 {:x 46.76198226402113, :y 183.50021331304703} {:x 35.795999872750116, :y 176.0015802992897} {:x 30.747548058555935, :y 149.98674791289665} {:x 53.896872691589905, :y 126.33180419350093}
    3/7 {:x 46.2302324791017, :y 157.5556024360176} {:x 34.166307095987676, :y 168.98399757226994} {:x 39.06439652605054, :y 199.74943851105579} {:x 58.2260444466621, :y 211.10181203972857}
    3/7 {:x 50.771898926319665, :y 138.50355888469056} {:x 26.408202824464468, :y 161.17575671392626} {:x 42.17681549183168, :y 186.14761778279598} {:x 50.91354772883816, :y 191.23268606824269}
    3/7 {:x 59.45735074890702, :y 149.31073467714623} {:x 35.3670875649816, :y 137.63156551565385} {:x 33.96760025490062, :y 114.4273444142446} {:x 60.77668511048964, :y 93.63601575592159}
    3/7 {:x 31.14160955448391, :y 371.7951255241883} {:x 22.06695577112812, :y 365.1381888382363} {:x 32.836842988362434, :y 342.6132585966753} {:x 53.68109210750966, :y 321.51179073726115}
    3/7 {:x 44.54006577001357, :y 134.44486911234407} {:x 29.538341058862287, :y 147.76735203114157} {:x 36.55847375511618, :y 168.58223649469008} {:x 63.18859120636105, :y 182.8018938746048}
    2/7 {:x 43.85292699139598, :y 409.5276064742833} {:x 31.780381436784047, :y 401.74837284429225} {:x 28.753889780738962, :y 381.9441168612705} {:x 43.871547584823354, :y 369.34384942935435}
    2/7 {:x 35.235761070102185, :y 151.67837579930023} {:x 29.22084386461304, :y 155.68900633553034} {:x 34.975000552657306, :y 171.88661493471574} {:x 49.20219343187536, :y 178.42769295609588}
    2/7 {:x 42.86052034192366, :y 128.61075146547608} {:x 25.208502461482283, :y 117.09989367683018} {:x 52.6772695540222, :y 83.4100702046399} {:x 76.84797152532374, :y 63.05023395492754}
    2/7 {:x 53.69809598577194, :y 422.8568151995894} {:x 38.649835473705735, :y 412.7174517833914} {:x 32.63934418097809, :y 385.59142565875544} {:x 44.708903036856405, :y 375.2466917851884}
    1/7 {:x 35.09110033401507, :y 194.7853901221735} {:x 29.077309714102977, :y 189.50779110499042} {:x 41.6599809923978, :y 154.91059630956028} {:x 63.193951945751934, :y 133.87384914362931}
    1/7 {:x 49.6198159077909, :y 280.06487853848455} {:x 28.528773765385182, :y 265.4061582190621} {:x 25.82124255255491, :y 249.64898040985236} {:x 38.28056637728082, :y 239.80795881237077}
    1/7 {:x 55.3776888994217, :y 305.9267649216262} {:x 30.314626306273166, :y 298.7578354661058} {:x 42.48064269324702, :y 285.07770934142144} {:x 61.400475864819605, :y 278.23228433624706}
    1/7 {:x 62.491259354683706, :y 218.62526015802766} {:x 39.362861628255274, :y 230.38012777240644} {:x 37.5959390268963, :y 250.97966247396758} {:x 54.68511912695186, :y 258.05539614371344}
    0 {:x 36.0931498970607, :y 409.8859002652171} {:x 21.043244653839025, :y 399.24042827183064} {:x 28.03628933479149, :y 385.76355775804245} {:x 47.55579950215319, :y 371.93553518339206}
    0 {:x 46.383311632321124, :y 406.10903979947005} {:x 33.34380795306686, :y 394.97316274147437} {:x 31.175211830121654, :y 369.350694983778} {:x 48.83869117527496, :y 354.7224181897758}
    0 {:x 53.336111371415186, :y 43.319232264556014} {:x 32.23643574983709, :y 54.714020131180554} {:x 36.952096414853315, :y 73.25469473035284} {:x 53.441144362829974, :y 81.922645070958}
    0 {:x 55.52557680250902, :y 141.52147275659974} {:x 32.917301882496645, :y 124.69961496964893} {:x 41.29734228815749, :y 94.92978280919218} {:x 58.81791957792156, :y 82.24819748384085}
    -1/7 {:x 51.37886156609911, :y 395.6791953552271} {:x 33.25909782433698, :y 386.4484169419867} {:x 45.733730110207475, :y 364.3164725266336} {:x 62.7306167922256, :y 357.14915808101546}
    -1/7 {:x 58.45122398963356, :y 221.09973270908958} {:x 37.77402935637048, :y 233.1563668691064} {:x 24.238995632002446, :y 249.96487190784902} {:x 52.80763926758275, :y 268.9723554227521}
    -1/7 {:x 52.88677124960306, :y 460.1377553211075} {:x 34.72910520927586, :y 449.79760386770187} {:x 23.381791068270957, :y 436.1634320986744} {:x 33.597318917254405, :y 431.22240162524156}
    -1/7 {:x 45.90521093765432, :y 258.990727515525} {:x 29.04007797651456, :y 270.4908380452776} {:x 43.113233561367004, :y 301.35660020218785} {:x 67.23283777091073, :y 320.3140647186575}
    -2/7 {:x 41.75659625569871, :y 187.4110130061147} {:x 23.6789698077329, :y 199.10753400813618} {:x 38.68394672623112, :y 220.53796350704982} {:x 56.710391641505545, :y 235.56503993411252}
    -2/7 {:x 45.17629399933344, :y 56.90719443067879} {:x 33.09529961250723, :y 66.82208133009333} {:x 29.887072230984653, :y 91.40756982254928} {:x 44.97595860916099, :y 106.64741965778404}
    -2/7 {:x 32.30401784277021, :y 401.6960163872054} {:x 26.281096608000375, :y 397.6431696203206} {:x 38.631876495705995, :y 381.63271718427336} {:x 56.4528446122563, :y 373.3567319461734}
    -2/7 {:x 54.82585026964148, :y 275.62646466478316} {:x 30.115685902297283, :y 291.93804836944963} {:x 26.216352593858304, :y 310.2147354750566} {:x 39.84403341486858, :y 322.1557783170724}
    -3/7 {:x 54.27957653541418, :y 368.83544947212874} {:x 39.27102401482218, :y 358.7851975249993} {:x 29.820453956774966, :y 336.9737076508549} {:x 44.38356793167492, :y 331.2426208921176}
    -3/7 {:x 44.03371372237241, :y 227.45958472890396} {:x 32.96555509731047, :y 233.55930583529388} {:x 32.01744618393536, :y 253.3159594615349} {:x 49.27924108398634, :y 267.845574650353}
    -3/7 {:x 54.115321625697774, :y 220.2832178967914} {:x 36.04343676828098, :y 232.5812533896067} {:x 35.19969299905783, :y 261.702178367367} {:x 50.182038534469314, :y 275.7212529381545}
    -3/7 {:x 58.75882841092083, :y 368.65516999673815} {:x 37.60636952783329, :y 350.98477063668616} {:x 42.8933678027154, :y 319.8683507207719} {:x 58.00162903584092, :y 312.1849104031363}

    1/2 {:x 42.89036170559099, :y 229.14717888160584} {:x 21.805701834444733, :y 243.65485312778608} {:x 23.21787819940372, :y 250.50318459477924} {:x 41.80879044833422, :y 257.2613888007048}
    1/2 {:x 56.205262990969366, :y 64.72715215437998} {:x 41.12985819462902, :y 72.86083788248907} {:x 31.502231635502895, :y 89.34936375473772} {:x 56.86501858678513, :y 95.42996399246744}
    1/2 {:x 45.284190000151824, :y 95.13497762144105} {:x 24.272602285043106, :y 109.20564748537569} {:x 30.024616939273827, :y 120.44732436573533} {:x 44.781597757122555, :y 125.65871416155154}
    1/2 {:x 57.03936704144496, :y 136.30283170557195} {:x 41.94074772752593, :y 144.9573885991798} {:x 32.4123323892214, :y 162.63508467470194} {:x 58.01373962616179, :y 169.33829350476367}
    1/2 {:x 62.837155100083265, :y 371.2263393994103} {:x 36.06960781493656, :y 380.0496073036366} {:x 29.90283875244743, :y 387.17391441812117} {:x 55.80865389196446, :y 388.81786021248126}
    ))
